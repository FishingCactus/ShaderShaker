<project name="Shader Shaker" basedir=".">

	<property name="shader_shaker" location="../bin/debug/shader_shaker" />
	
	<condition property="executable_exists">
		<resourceexists>
            <file file="../bin/debug/shader_shaker" />
        </resourceexists>
	</condition>
	
	<target name="generate_reference" if="executable_exists">
		<apply executable="${shader_shaker}" dir="..">
			<mapper type="glob" from="*.fx" to="*.reference.ast"/>
			<arg value="-o"/>
			<targetfile />
			<srcfile />
			
			<fileset dir=".">
				<include name="**/*.fx" />
				<exclude name="optim/**/*" />
			</fileset>
		</apply>

		<apply executable="${shader_shaker}" dir="..">
			<mapper type="glob" from="*.fx" to="*.reference.ast"/>
			<arg value="-optimization true"/>
			<arg value="-o"/>
			<targetfile/>
			<srcfile/>

			<fileset dir=".">
				<include name="optim/**/*.fx" />
			</fileset>
		</apply>
	</target>
	
	<target name="check" if="executable_exists">
		<apply executable="${shader_shaker}" force="true" dir="..">
			<mapper type="glob" from="*.fx" to="*.reference.ast"/>
			<arg value="-check"/>
			<targetfile/>
			<srcfile/>

			<fileset dir=".">
				<include name="**/*.fx" />
				<exclude name="optim/**/*" />
			</fileset>
		</apply>

		<apply executable="${shader_shaker}" force="true" dir="..">
			<mapper type="glob" from="*.fx" to="*.reference.ast"/>
			<arg value="-optimization true"/>
			<arg value="-check"/>
			<targetfile/>
			<srcfile/>

			<fileset dir=".">
				<include name="optim/**/*.fx" />
			</fileset>
		</apply>
	</target>
</project>